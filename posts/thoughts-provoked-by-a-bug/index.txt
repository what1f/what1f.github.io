3:I[5613,[],""]
5:I[1778,[],""]
6:I[2175,["70","static/chunks/app/(articles)/layout-00d245b5a8171f02.js"],""]
4:["slug","thoughts-provoked-by-a-bug","d"]
7:{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"}
8:{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"}
9:{"display":"inline-block"}
a:{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0}
0:["f-8OKS-SOdLM_km42vR2a",[[["",{"children":["(articles)",{"children":["posts",{"children":[["slug","thoughts-provoked-by-a-bug","d"],{"children":["__PAGE__?{\"slug\":\"thoughts-provoked-by-a-bug\"}",{}]}]}]},"$undefined","$undefined",true]}],["",{"children":["(articles)",{"children":["posts",{"children":[["slug","thoughts-provoked-by-a-bug","d"],{"children":["__PAGE__",{},["$L1","$L2",null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(articles)","children","posts","children","$4","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/5343b87885033c09.css","precedence":"next","crossOrigin":"anonymous"}]]}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(articles)","children","posts","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},[null,["$","$L6",null,{"children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(articles)","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":null}],"params":{}}],null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":"$7","children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":"$8","children":"404"}],["$","div",null,{"style":"$9","children":["$","h2",null,{"style":"$a","children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/006888e039cb19be.css","precedence":"next","crossOrigin":"anonymous"}]]}]],[null,"$Lb"]]]]
2:["$","main",null,{"className":"markdown-body !bg-eerie-black-1 !text-white-2 box-border min-w-[200px] max-w-[980px] !my-0 !mx-auto p-[45px] pt-0 max-md:p-[15px] max-md:pt-0","children":["$","article",null,{"children":[["$","h1","h1-0",{"children":"MySQL和ES数据不一致"}],"\n",["$","p","p-0",{"children":["项目中使用了",["$","code",null,{"className":"$undefined","children":"ES"}],"作为搜索引擎来避免慢查询，",["$","code",null,{"className":"$undefined","children":"MySQL"}],"到",["$","code",null,{"className":"$undefined","children":"ES"}],"的同步逻辑为更新DB后发送",["$","code",null,{"className":"$undefined","children":"Kafka"}],"消息，另一个服务来消费消息并写入",["$","code",null,{"className":"$undefined","children":"ES"}],"，最近发现偶尔会出现",["$","code",null,{"className":"$undefined","children":"MySQL"}],"和",["$","code",null,{"className":"$undefined","children":"ES"}],"的数据不一致的情况。"]}],"\n",["$","p","p-1",{"children":["最终定位到了一个更新数据的方法",["$","code",null,{"className":"$undefined","children":"updateA"}],"，此方法被注解为",["$","code",null,{"className":"$undefined","children":"Transactional"}],"，前半部分为更新DB和缓存等，最后一步是异步地去发",["$","code",null,{"className":"$undefined","children":"kafka"}],"更新",["$","code",null,{"className":"$undefined","children":"ES"}],"。后续迭代中，",["$","code",null,{"className":"$undefined","children":"updateB"}],"引用了这个方法，并且由于",["$","code",null,{"className":"$undefined","children":"updateB"}],"也有数据需要更新，所以在",["$","code",null,{"className":"$undefined","children":"updateB"}],"上也加了",["$","code",null,{"className":"$undefined","children":"Transactional"}],"的注解。"]}],"\n",["$","h2","h2-0",{"children":"问题复现"}],"\n",["$","p","p-2",{"children":"简单还原下出现问题的代码："}],"\n",["$","pre","pre-0",{"children":["$","div",null,{"style":{"background":"hsl(220, 13%, 18%)","color":"hsl(220, 14%, 71%)","textShadow":"0 1px rgba(0, 0, 0, 0.3)","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1em","margin":"0.5em 0","overflow":"auto","borderRadius":"0.3em"},"children":["$","code",null,{"className":"language-java","style":{"background":"hsl(220, 13%, 18%)","color":"hsl(220, 14%, 71%)","textShadow":"0 1px rgba(0, 0, 0, 0.3)","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"token annotation","style":{"color":"hsl(220, 14%, 71%)"},"children":["@Transactional"]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement3",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["public"]}],["$","span","code-segement4",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement5",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["void"]}],["$","span","code-segement6",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement7",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["updateA"]}],["$","span","code-segement8",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":["xxx"]}],["$","span","code-segement10",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement12",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["{"]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement14",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement15",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["// 更新MySQL"]}],["$","span","code-segement16",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement18",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["updateDB"]}],["$","span","code-segement19",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segement20",{"className":"$undefined","style":{},"children":["xxx"]}],["$","span","code-segement21",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segement22",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[";"]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement24",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement25",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["// 更新缓存"]}],["$","span","code-segement26",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement28",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["updateCache"]}],["$","span","code-segement29",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segement30",{"className":"$undefined","style":{},"children":["xxx"]}],["$","span","code-segement31",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segement32",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[";"]}],["$","span","code-segement33",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement34",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement35",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["// 异步发消息更新ES"]}],["$","span","code-segement36",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement37",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement38",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["asyncSendMessage"]}],["$","span","code-segement39",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segement40",{"className":"$undefined","style":{},"children":["xxx"]}],["$","span","code-segement41",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segement42",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[";"]}],["$","span","code-segement43",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement44",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement45",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["}"]}],["$","span","code-segement46",{"className":"$undefined","style":{},"children":["\n"]}],"\n",["$","span","code-segement48",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement49",{"className":"token annotation","style":{"color":"hsl(220, 14%, 71%)"},"children":["@Transactional"]}],["$","span","code-segement50",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement51",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement52",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["public"]}],["$","span","code-segement53",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement54",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["void"]}],["$","span","code-segement55",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement56",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["updateB"]}],["$","span","code-segement57",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segement58",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segement59",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement60",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["{"]}],["$","span","code-segement61",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement62",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement63",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["// 更新MySQL"]}],["$","span","code-segement64",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement65",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement66",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["updateDB"]}],["$","span","code-segement67",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segement68",{"className":"$undefined","style":{},"children":["xxx"]}],["$","span","code-segement69",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segement70",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[";"]}],["$","span","code-segement71",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement72",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement73",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["// 调用已有方法更新A"]}],["$","span","code-segement74",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement75",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement76",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["updateA"]}],["$","span","code-segement77",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segement78",{"className":"$undefined","style":{},"children":["xxx"]}],["$","span","code-segement79",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segement80",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[";"]}],["$","span","code-segement81",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement82",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement83",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["// 执行其他操作"]}],["$","span","code-segement84",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement85",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement86",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segement87",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segement88",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segement89",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement90",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement91",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["}"]}]]]}]}]}],"\n",["$","p","p-3",{"children":["这里有一个非常重要的点是",["$","code",null,{"className":"$undefined","children":"asyncSendMessage"}],"方法里",["$","strong","strong-0",{"children":"依赖了DB中的最新数据"}],"，其实如果真实的业务代码就长这样的话，还是比较容易看出问题的：",["$","code",null,{"className":"$undefined","children":"asyncSendMessage"}],"是异步的，会和",["$","code",null,{"className":"$undefined","children":"updateB"}],"里余下的操作并行，并且",["$","code",null,{"className":"$undefined","children":"updateB"}],"是加了",["$","code",null,{"className":"$undefined","children":"Transactional"}],"注解的，",["$","code",null,{"className":"$undefined","children":"updateA"}],"加入了",["$","code",null,{"className":"$undefined","children":"updateB"}],"的事务，此时",["$","code",null,{"className":"$undefined","children":"updateA"}],"中DB的更新还未提交，所以异步发消息的时候只能读到DB中旧的数据，从而导致更新到",["$","code",null,{"className":"$undefined","children":"ES"}],"中的是旧数据。"]}],"\n",["$","p","p-4",{"children":["为什么这个问题是偶现的呢？那是因为异步发消息这个方法里并不是简单的直接发消息，还有各种前置的数据组装流程，如果",["$","code",null,{"className":"$undefined","children":"updateB"}],"余下的代码执行得够快，就能抢在",["$","code",null,{"className":"$undefined","children":"asyncSendMessage"}],"中的",["$","code",null,{"className":"$undefined","children":"DB"}],"查询之前提交事务，这样",["$","code",null,{"className":"$undefined","children":"asyncSendMessage"}],"中拿到的就是新数据了。"]}],"\n",["$","h2","h2-1",{"children":"排查过程中的坑"}],"\n",["$","p","p-5",{"children":["从上面来看，这个问题好像非常基础，且容易发现。但实际排查这个问题的时候还是花了不少时间，这是因为",["$","code",null,{"className":"$undefined","children":"updateA"}],"中的逻辑非常复杂，光是方法本身就几百行代码，并且嵌套得也很深，异步发消息更新",["$","code",null,{"className":"$undefined","children":"ES"}],"这个动作隐藏在了最底层一个看着是公共方法里（当时也许是想减少同步",["$","code",null,{"className":"$undefined","children":"MySQL"}],"到",["$","code",null,{"className":"$undefined","children":"ES"}],"的重复代码？）。所以在后续的迭代引入",["$","code",null,{"className":"$undefined","children":"updateB"}],"时，",["$","code",null,{"className":"$undefined","children":"updateB"}],"自身也发了更新",["$","code",null,{"className":"$undefined","children":"ES"}],"的消息，这导致更新",["$","code",null,{"className":"$undefined","children":"ES"}],"的消息发送了两次，而异步发送的那次有一定的概率拿到的是旧数据，所以才会出现",["$","code",null,{"className":"$undefined","children":"ES"}],"中最终保存的是旧数据。（这里还有一个比较坑的地方，异步发消息的逻辑没有把trace id包进去，导致拿着trace id看日志的时候只查到发送了一次消息，且内容为最新的，非常具有迷惑性！！！）。"]}],"\n",["$","h2","h2-2",{"children":"总结"}],"\n",["$","p","p-6",{"children":["问题本身其实没什么好总结的，就是错误使用了异步&事务。但这次踩坑引发了我的思考：",["$","strong","strong-0",{"children":"为什么会写出这样的代码？"}]]}],"\n",["$","p","p-7",{"children":"发出这个疑问并不是说要批斗写出这样代码的人，而是想从软件工程的角度上思考下，为什么会发生这样的情况。"}],"\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":["\n",["$","p","p-0",{"children":[["$","strong","strong-0",{"children":"对已有逻辑的复用"}],"：复用前人留下的代码时，没有仔细地去检查代码逻辑，而是比较粗暴的沿用了。不过我认为，虽然这是引起这个bug最直接的原因，但并不是最根本的原因，因为这个",["$","code",null,{"className":"$undefined","children":"updateA"}],"方法实在太复杂了，主打一个all in one，A以及A关联的业务数据更新&缓存更新&消息发送都在这里面，想要理清楚其内部错综复杂的逻辑得花非常多的时间和精力。"]}],"\n"]}],"\n",["$","li","li-1",{"children":["\n",["$","p","p-0",{"children":[["$","strong","strong-0",{"children":"复杂代码的恶循环"}],"：",["$","code",null,{"className":"$undefined","children":"updateA"}],"方法逻辑写得过于复杂，也许当时写这段逻辑的人认为这个方法就是给部分接口专用的，觉得其他地方不用复用这个方法。但业务是会不断迭代的，这段代码大概率是熟悉相关业务逻辑的唯一渠道，当后续接手这个项目的人需要有这段逻辑相关的业务开发时，将会面临两个选择："]}],"\n",["$","ol","ol-0",{"children":["\n",["$","li","li-0",{"children":["\n",["$","p","p-0",{"children":["复用这一段代码：构造出方法",["$","code",null,{"className":"$undefined","children":"updateA"}],"庞大的入参，并对内部部分不适配的逻辑打补丁来兼容新的业务逻辑"]}],"\n"]}],"\n",["$","li","li-1",{"children":["\n",["$","p","p-0",{"children":["重构这一段代码：将",["$","code",null,{"className":"$undefined","children":"updateA"}],"从头到尾梳理一遍，并实现一套新的逻辑来提供扩展性。"]}],"\n"]}],"\n"]}],"\n",["$","p","p-1",{"children":["我相信，在实际的业务开发中选择第二个选项的可能性几乎为0。因为成本和风险都太高了，",["$","code",null,{"className":"$undefined","children":"updateA"}],"以及其内部嵌套的代码加起来小几千行，并且错综复杂。理解和重构的成本极高，并且理解成本高会带来另一个问题，一些角落的细节逻辑非常容易被遗漏。选择重构引入了巨大的成本和风险，这两点都是业务迭代中不被允许的，很少人会选择这样一条极其曲折且伴随了风险，但又难以体现业务价值的路。"]}],"\n",["$","p","p-2",{"children":["所以我们只能想方设法来复用",["$","code",null,{"className":"$undefined","children":"updateA"}],"，首先我们需要拿现有数据构造出符合",["$","code",null,{"className":"$undefined","children":"updateA"}],"的入参（实际上代码里已经有人这样干了，新增了一个",["$","code",null,{"className":"$undefined","children":"genUpdateAParams"}],"的一个方法用于构造符合",["$","code",null,{"className":"$undefined","children":"updateA"}],"的参数，光是这个方法都好几百行🤦🏻），然后再往",["$","code",null,{"className":"$undefined","children":"updateA"}],"以及其嵌套的逻辑中打",["$","code",null,{"className":"$undefined","children":"if ... else"}],"补丁来适配新的业务规则。好了，代码已经踏上了奔往💩山的不归路，下一个改到相关逻辑的时候得去理解",["$","code",null,{"className":"$undefined","children":"updateA"}],"和",["$","code",null,{"className":"$undefined","children":"genUpdateAParams"}],"这两座💩山了，于是开始在",["$","code",null,{"className":"$undefined","children":"updateA"}],"和",["$","code",null,{"className":"$undefined","children":"genUpdateAParams"}],"中同时打补丁，甚至又多加一座。。。"]}],"\n"]}],"\n"]}],"\n",["$","p","p-8",{"children":["我们反过来想一想，如果",["$","code",null,{"className":"$undefined","children":"updateA"}],"方法真的像我们示例中的那样简洁明了，后面的迭代是不是更不容易写出难以理解和维护的代码呢？"]}],"\n",["$","p","p-9",{"children":["我想结果是显然的，在实现",["$","code",null,{"className":"$undefined","children":"updateB"}],"的时候，我们可以很轻易地复用",["$","code",null,{"className":"$undefined","children":"updateA"}],"中的",["$","code",null,{"className":"$undefined","children":"updateDB"}],"和",["$","code",null,{"className":"$undefined","children":"updateCache"}],"，然后发送自己所需要的消息以及后续的逻辑，而不是被迫复用整个",["$","code",null,{"className":"$undefined","children":"updateA"}],"，那么也不会有",["$","code",null,{"className":"$undefined","children":"genUpdateAParams"}],"的出现了。"]}],"\n",["$","p","p-10",{"children":[["$","strong","strong-0",{"children":"结语："}]," 写出简洁、清晰的代码是非常重要的，少做一点妥协，尽量写好每一段代码，哪怕这个方法后面真的永远不会被复用或者改动。毕竟代码更多时候是用来读的，简洁清晰的代码可以让其他人更容易理解其背后的业务逻辑（btw，这个其他人也可能是几个月后的自己👀）。"]}]]}]}]
b:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"一个bug引发的思考：不可维护的代码是怎么形成的"}],["$","link","3",{"rel":"manifest","href":"/site.webmanifest"}],["$","meta","4",{"property":"og:title","content":"一个bug引发的思考：不可维护的代码是怎么形成的"}],["$","meta","5",{"property":"og:image","content":"http://localhost:3000/images/developer-1.jpg"}],["$","meta","6",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","7",{"name":"twitter:title","content":"一个bug引发的思考：不可维护的代码是怎么形成的"}],["$","meta","8",{"name":"twitter:image","content":"http://localhost:3000/images/developer-1.jpg"}],["$","link","9",{"rel":"shortcut icon","href":"/apple-touch-icon.png"}],["$","link","10",{"rel":"icon","href":"/favicon.ico?v=4"}],["$","link","11",{"rel":"apple-touch-icon","href":"/apple-touch-icon.png?v=4"}]]
1:null
